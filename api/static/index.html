<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–≥—Ä—É–∑–∫–∏</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css?v=3.8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        body {
            padding-bottom: 120px;
            /* background: #fff;  Removed to let style.css control bg */
        }

        /* ... existing styles ... */
    </style>
</head>

<body class="bottom-nav-active">

    <!-- Version Indicator -->
    <div
        style="position: fixed; top: 10px; right: 10px; background: rgba(112, 0, 255, 0.9); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; z-index: 9999; font-weight: bold;">
        v3.8
    </div>

    <div class="container py-3">

        <!-- ============================
             SECTION 1: MAIN (HOME)
             ============================ -->
        <div id="mainSection" class="section active">
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="mainSearchInput" class="search-input" placeholder="Search products...">
            </div>


            <!-- Banner Carousel with Indicators -->
            <div class="banner-wrapper">
                <div class="banner-carousel">
                    <div class="banner-slide active">
                        üéâ New Year Sale - Up to 50% Off!
                    </div>
                    <div class="banner-slide">
                        üöö Free Delivery on Orders Over $100
                    </div>
                    <div class="banner-slide">
                        ‚≠ê Top Rated Products - Shop Now!
                    </div>
                    <!-- Indicators positioned absolutely inside carousel -->
                    <div class="carousel-indicators">
                        <span class="dot active"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="section-header">
                <span>Categories</span>
            </div>
            <div class="category-scroll" id="categoryScroll">
                <!-- Will be populated by JS -->
            </div>

            <!-- Featured Products -->
            <div class="section-header">
                <span>Featured Products</span>
                <a href="#" class="view-all" onclick="navigateToSection('catalogSection'); return false;">View All</a>
            </div>
            <div class="product-grid" id="featuredGrid">
                <!-- Will be populated by JS -->
            </div>
        </div>

        <!-- ============================
             SECTION 2: CATALOG
             ============================ -->
        <div id="catalogSection" class="section">
            <!-- Reuse existing market container -->
            <div class="market-container">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search products...">
                </div>
                <div id="productGrid" class="product-grid mt-2">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>

        <!-- ============================
             SECTION 3: CART
             ============================ -->
        <div id="cartSection" class="section">
            <div class="cart-header">
                <h2>Cart (<span id="cartItemCount">0</span> items)</h2>
                <button class="clear-cart-btn" onclick="clearCart()" title="Clear cart">üóëÔ∏è</button>
            </div>

            <div id="cartContent">
                <!-- Cart items will be inserted here by JS -->
            </div>

            <!-- Empty cart state (hidden initially) -->
            <div id="emptyCartState" class="empty-cart" style="display: none;">
                <div class="icon">üõí</div>
                <h3>Your cart is empty</h3>
                <p>Start adding products to see them here</p>
                <button class="checkout-btn" onclick="navigateToSection('catalogSection')">Continue Shopping</button>
            </div>
        </div>

        <!-- ============================
             SECTION 4: PROFILE
             ============================ -->
        <div id="profileSection" class="section">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <div class="profile-name" id="profileName">User Name</div>
                <div class="profile-username" id="profileUsername">@username</div>
            </div>

            <div class="profile-menu">
                <div class="menu-item" onclick="showUserOrders()">
                    <span class="icon">üì¶</span>
                    <span class="text">My Orders</span>
                    <span class="chevron">‚Ä∫</span>
                </div>

                <div class="menu-item" onclick="showDeliveries()">
                    <span class="icon">üöö</span>
                    <span class="text">Deliveries (SAP)</span>
                    <span class="badge" id="deliveriesCount" style="display: none;">0</span>
                    <span class="chevron">‚Ä∫</span>
                </div>

                <div class="menu-item" onclick="showFavorites()">
                    <span class="icon">‚≠ê</span>
                    <span class="text">Favorites</span>
                    <span class="chevron">‚Ä∫</span>
                </div>

                <div class="menu-item" onclick="showAddresses()">
                    <span class="icon">üìç</span>
                    <span class="text">Addresses</span>
                    <span class="chevron">‚Ä∫</span>
                </div>

                <div class="menu-item" onclick="showSettings()">
                    <span class="icon">‚öôÔ∏è</span>
                    <span class="text">Settings</span>
                    <span class="chevron">‚Ä∫</span>
                </div>

                <div class="menu-item" onclick="showSupport()">
                    <span class="icon">üìû</span>
                    <span class="text">Support</span>
                    <span class="chevron">‚Ä∫</span>
                </div>
            </div>
        </div>

        <!-- ============================
             DELIVERIES SUB-VIEW (Hidden, shown when user clicks Deliveries)
             ============================ -->
        <div id="deliveriesView" class="section" style="display: none;">
            <div
                style="padding: 15px; background: var(--card-bg); border-bottom: 1px solid var(--border-light); position: sticky; top: 0; z-index: 100;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button onclick="hideDeliveries()"
                        style="background: none; border: none; font-size: 24px; cursor: pointer;">‚Üê</button>
                    <h2 style="margin: 0; font-size: 20px;">Deliveries</h2>
                </div>
            </div>

            <!-- Top Controls (Year) -->
            <div class="top-controls px-3 pb-2" id="deliveriesControls">
                <div class="d-flex justify-content-between align-items-center">
                    <select id="yearSelect" class="form-select form-select-sm w-auto">
                        <option value="2027">2027</option>
                        <option value="2026" selected>2026</option>
                        <option value="2025">2025</option>
                    </select>

                    <div class="d-flex gap-1">
                        <button id="prevBtn" class="btn btn-sm btn-outline-secondary">‚Üê</button>
                        <button id="nextBtn" class="btn btn-sm btn-outline-secondary">‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs mb-2 px-3" id="tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-tab="today">New</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="history">All</a>
                </li>
            </ul>

            <!-- Scrollable content -->
            <div class="scroll-area px-3">
                <div id="today"></div>
                <div id="history" style="display:none"></div>
            </div>
        </div>

        <!-- Details Modal (For both deliveries and product details) -->
        <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <table class="table table-striped table-sm mb-0" style="font-size: 0.9em;">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Item</th>
                                    <th class="text-end">Quantity</th>
                                    <th class="text-end">Price</th>
                                    <th class="text-end pe-3">Total</th>
                                </tr>
                            </thead>
                            <tbody id="detailsTableBody"></tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ============================
         BOTTOM NAVIGATION
         ============================ -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navigateToSection('mainSection')">
            <div class="icon">üè†</div>
            <div class="label">Main</div>
        </div>
        <div class="nav-item" onclick="navigateToSection('catalogSection')">
            <div class="icon">üì±</div>
            <div class="label">Catalog</div>
        </div>
        <div class="nav-item" onclick="navigateToSection('cartSection')">
            <div class="icon">üõí</div>
            <div class="label">Cart</div>
            <span class="cart-count" id="navCartCount" style="display: none;">0</span>
        </div>
        <div class="nav-item" onclick="navigateToSection('profileSection')">
            <div class="icon">üë§</div>
            <div class="label">Profile</div>
        </div>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js?v=3.8"></script>
    <script src="/static/market.js?v=3.8"></script>
    <script src="/static/main.js?v=3.8"></script>
    <script src="/static/cart.js?v=3.8"></script>
    <script src="/static/profile.js?v=3.8"></script>

</body>

</html>